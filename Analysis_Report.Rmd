---
title: "India Air Quality Index - Data Analysis"
author: "Rishi Dey Chowdhury"
date: "7/9/2021"
output: html_document
keep_md: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(lubridate)
library(modelr)
library(psych)
library(car)
library(GGally)
library(ggpubr)
library(ggrepel)
library(purrr)
library(knitr)
library(kableExtra)
library(stringr)
library(viridis)
library(formattable)
#library(skimr)
library(moderndive)
library(infer)
#library(fitdistrplus)
library(pander)
library(stargazer)
library(forcats)
library(broom)
library(jtools)
library(huxtable)
library(broom.mixed)
options(dplyr.summarise.inform = FALSE)
```

```{r raw_data, cache=TRUE, include=FALSE}
# Importing my data sets
air_data_world <- read_csv("E:\\MY COLLEGE\\ISI KOLKATA\\1ST YEAR\\PROJECTS\\2ND SEM\\STATISTICAL METHODS II\\Air Quality Index\\all_air_data.csv", comment = '#')

station_list <- readxl::read_excel("E:\\MY COLLEGE\\ISI KOLKATA\\1ST YEAR\\PROJECTS\\2ND SEM\\STATISTICAL METHODS II\\Air Quality Index\\Station_List.xlsx", skip = 1)
```

```{r processed_data, cache=TRUE, dependson="raw_data", include=FALSE}
# Separating out the date column for easier analysis
air_data_world <- air_data_world %>%
  mutate(Year = year(Date), Month = month(Date), Day = day(Date)) %>%
  select(Year, Month, Day, Country, City, Specie, count, min, max, median, variance)

# Filtering Data relevant to INDIA
air_data_india <- air_data_world %>%
  filter(Country == "IN")
air_data_india <- air_data_india %>%
  select(Year:Day, City:variance)

rm(air_data_world)

# Changing some basic flaws in data
correct <- function(x) return(ifelse(x == "wind speed", "wind-speed", x))
air_data_india$Specie <- correct(air_data_india$Specie)
correct <- function(x) return(ifelse(x == "wind gust", "wind-gust", x))
air_data_india$Specie <- correct(air_data_india$Specie)
air_data_india <- air_data_india %>%
  filter(Specie != "wd")
correct <- function(x) return(ifelse(x == "New Delhi", "Delhi", x))
air_data_india$City <- correct(air_data_india$City)

# Arranging the Data according to Year
air_data_india <- air_data_india %>%
  arrange(Year, Month, Day)

# Trying to separate the column Specie for easier analysis -- widening the data
spec1 <- air_data_india %>%
  build_wider_spec(names_from = Specie, values_from = c(count, min, max, median, variance, Year, Month, Day, City))
# Separate based on Specie
air_data_india_Specie <- air_data_india %>%
  group_by(Specie) %>%
  mutate(row = row_number()) %>%
  pivot_wider_spec(spec1) %>%
  select(-row) %>%
  select(contains("Year"), contains("Month"), contains("Day"), contains("City"), everything())

# Separate based on City
spec2 <- air_data_india %>%
  build_wider_spec(names_from = City, values_from = c(Specie, count, min, max, median, variance, Year, Month, Day, City))

air_data_india_City <- air_data_india %>%
  group_by(City) %>%
  mutate(row = row_number()) %>%
  pivot_wider_spec(spec2) %>%
  select(-row) %>%
  select(contains("Year"), contains("Month"), contains("Day"), contains("City"), everything())

# Filtering out the pollutants only
air_data_india_pollutants <- air_data_india %>%
  filter(Specie %in% c('pm25', 'pm10', 'o3', 'so2', 'no2', 'co'))

# Filtering out the non-pollutants
air_data_india_nonpollutants <- air_data_india %>%
  filter(!(Specie %in% c('pm25', 'pm10', 'o3', 'so2', 'no2', 'co')))

# Making List of Stations.
colnames(station_list) <- c("Sl.No.State", "State", "Sl.No.City", "City", "Sl.No.Station", "Station")
station_list <- station_list %>%
  select(State, City, Station) %>%
  fill(State) %>%
  fill(City) %>%
  fill(Station)

station_list <- station_list %>%
  filter(City %in% unique(air_data_india$City)) %>%
  group_by(State, City) %>%
  summarise("Number of Stations" = n())

# Some preliminary cleaning
air_data_india_All_Specie_Daily_AQI_formulated <- air_data_india %>%
  group_by(Year, Month, Day,  Specie, City) %>%
  summarise(Min = mean(min, na.rm = TRUE), Median = mean(median, na.rm = TRUE), Max = mean(max, na.rm = TRUE), Var = mean(variance, na.rm = TRUE)) %>%
  gather(Min, Median, Max, Var, key = "Measure", value = "AQI") %>%
  spread(key = Specie, value = AQI) %>%
  filter(Year %in% c(2019, 2020, 2021), Measure != "Var") %>%
  group_by(Year, Month, Day, City) %>%
  mutate(so2 = mean(so2, na.rm = TRUE), no2 = mean(no2, na.rm = TRUE), co = mean(co, na.rm = TRUE), o3 = mean(o3, na.rm = TRUE), pm10 = mean(pm10, na.rm = TRUE), pm25 = mean(pm25, na.rm = TRUE), dew = mean(dew, na.rm = TRUE), humidity = mean(humidity, na.rm = TRUE), pessure = mean(pressure, na.rm = TRUE), temperature = mean(temperature, na.rm = TRUE), `wind-speed` = mean(`wind-speed`, na.rm = TRUE)) %>%
  mutate(AQI = max(co, no2, o3, so2, pm10, pm25, na.rm = TRUE))

air_data_india_All_Specie_Daily_AQI_formulated <- air_data_india_All_Specie_Daily_AQI_formulated %>%
  filter(City %in% c("Kolkata", "Delhi", "Muzaffarnagar", "Mumbai", "Lucknow", "Patna", "Chandigarh", "Gandhinagar", "Jaipur")) %>%
  mutate(Year = as.character(Year)) %>%
  filter(!is.na(so2)) %>%
  filter(!is.na(no2)) %>%
  filter(!is.na(co)) %>%
  filter(!is.na(o3)) %>%
  filter(!is.na(pm25)) %>%
  filter(!(is.na(pm10) & City == "Chandigarh")) %>%
  filter(!(is.na(pm10) & City == "Gandhinagar")) %>%
  filter(!(City == "Mumbai" & temperature < 15)) %>%
  filter(!((City == "Jaipur" & o3 > 100) | (City == "Lucknow" & o3 > 100) | (City == "Chandigarh" & o3 > 100))) %>%
  filter(!((City == "Mumbai" & co > 50))) %>%
  filter(!((City == "Patna" & no2 > 50))) %>%
  filter(!((City == "Patna" & so2 > 100))) %>%
  filter((humidity >= 20 & humidity <= 100) & (dew >= 0 & dew <= 50) & (temperature >= 0 & temperature <= 55) & (pressure >= 600)) %>%
  filter(Measure == "Median") %>%
  select(-c(Measure, precipitation, `wind-gust`))
```

# INTRODUCTION

In this Data Analysis Project, I am going to work with **Air Quality Index (AQI) Data of India**. I will be using several Statistical Tools to Analyze the Data which includes Exploratory Data Analysis, Techniques and methodologies used for Inference and Modelling.

### MOTIVE

-   To understand the relationship that holds between different parameters which we measure as a part of AQI Data of India.

-   To find out if COVID-19 Nation-wise Lockdowns, Social Distancing and Closure of Industries, Factories and Suspension of movement via private vehicles and public transport had a significant impact on India's AQI.

## UNDERSTANDING THE DATA

Let's take a look at the Data

```{r}
kable(head(air_data_india), caption = "First few rows of the Air Quality Index Data") %>%
  kable_styling(position = "center")
kable(tail(air_data_india), caption = "Last few rows of the Air Quality Index Data") %>%
  kable_styling(position = "center")
```

-   This Dataset contains `r nrow(air_data_india)` rows and `r ncol(air_data_india)` columns.

-   The Year ranges from 2014 to 2021 (till June), with observations recorded on each of the 30 /31 days of the month for 12 months for the last 3 years.

-   The Data is generated from the `r length(unique(air_data_india$City))` cities from various Stations located near that Cities. The Cities include:

```{r City_Stations_List}
kable(station_list, caption = "City Stations") %>%
  kable_styling(position = "center")
```

-   The parameters which we measure at the different Stations are given under the Specie Column and it includes -

```{r Specie_description}
Specie_description <- tibble(
  Parameters = unique(air_data_india$Specie),
  Description = c(
    "Particle pollution/particulate matter(particles less than or equal to 2.5 micrometers in diameter)",
    "Particle pollution/particulate matter(particles less than or equal to 10 micrometers in diameter)",
    "Ground-level ozone",
    "Sulphur dioxide",
    "Nitrogen dioxide",
    "Carbon Monoxide",
    "Temperature",
    "Air Pressure",
    "Wind Gust/Force",
    "Relative Humidity",
    "Wind Speed",
    "Dew Point",
    "Precipitation"
  ),
  Units = c("micrograms/cubic meter","micrograms/cubic meter","micrograms/cubic meter","micrograms/cubic meter","micrograms/cubic meter","miligrams/cubic meter","Celcius","Torr","kmph","No Units","kmph","Celcius","milimeters")
)
kable(Specie_description, caption = "Specie Description") %>%
  kable_styling(position = "center")
```

AQI is a comparable and communicable way of measuring the parameters in the Air. It is calculated when atleast 3 of the top 6 parameter's data is available of which one must be pm10 or pm25. It is the max of the parameters recorded given they satisfy the above condition.

-   It also helps in identifying faulty standards and inadequate monitoring programmes.

-   AQI helps in analysing the change in air quality (improvement or degradation).

-   Comparing air quality conditions at different locations/cities.

-   It can be easily interpreted by anyone, without knowing about background details.

```{r AQI_Info}
AQI_Info <- tibble(
  "AQI Values" = c(
    "0-50",
    "51-100",
    "101-150",
    "151-200",
    "201-300",
    "301-500"
  ),
  "Level of Health Concern" = c(
    "Good",
    "Moderate",
    "Unhealthy for sensitive group",
    "Unhealthy",
    "Very Unhealthy",
    "Hazardous"
  )
)
kable(AQI_Info, caption = "Significance of the AQI Values") %>%
  kable_styling(position = "center")
```

In further Analysis we will refer *pm25, pm10, o3, so2, no2 and co2 as pollutants* and the *remaining weather parameters as non-pollutants*.

## TOP CITY STATIONS

Here we look at *which city records how many observations per year*.

```{r obsv_per_station, fig.asp=0.618, fig.width=12}
obsv_per_station <- air_data_india %>%
  group_by(Year, City) %>%
  count() %>%
  arrange(Year, desc(n)) %>%
  spread(key = Year, value = n) %>%
  arrange(desc(`2019`, `2020`, `2021`))

air_data_india %>%
  group_by(Year, City) %>%
  count() %>%
  filter(Year %in% c("2021", "2020", "2019", "2018")) %>%
  ggplot(aes(City, n, fill = City)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  facet_wrap(~Year) +
  coord_flip() +
  labs(
    y = "Number of Observations Recorded",
    x = "Cities"
  ) +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 3,
      override.aes = list(size = 3)
    )
  ) + ggtitle("Observations Recorded Per Station Every Year") +
  scale_color_viridis(discrete = TRUE)
```

It seems **Delhi is the most monitored cities among the others**. We see all the other stations have almost equal number of observations per year. Our data seems to have lot of missing values for the year 2018 and the years before that; Hence we will only consider the data of the year 2019, 2020 and 2021.

Speculating on the reason *why Delhi is so heavily monitored* we look at *how the Average Median AQI Levels of pollutants at each city every year*.

```{r avg_median_per_year_per_station, fig.asp=0.618, fig.width=12}
avg_median_per_year_per_station <- air_data_india_pollutants %>%
  group_by(Year, City) %>%
  summarise(Median = mean(median)) %>%
  arrange(desc(Year, Median)) %>%
  spread(key = Year, value = Median) %>%
  arrange(desc(`2021`, `2020`, `2019`))

air_data_india_pollutants %>%
  group_by(Year, City) %>%
  summarise(Median = mean(median)) %>%
  arrange(desc(Year, Median)) %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018))) %>%
  ggplot(aes(City, Median, fill = City)) +
  geom_bar(stat = "identity") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  facet_wrap(~Year) +
  coord_flip() +
  labs(
    y = "Average Median AQI Levels of Pollutants"
  ) +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 3,
      override.aes = list(size = 3)
    )
  ) + ggtitle("Average Median AQI Levels of Pollutants Each City Every Year") +
  scale_color_viridis(discrete = TRUE)
```

Indeed it is clearly visible that **Delhi's AQI Levels of Pollutants is higher** than all other cities. This makes Delhi our city of main focus in all the further analysis. Every city owing to it's location at different parts of the country, different development status, different population, different local weather conditions has different measured values of AQI. So, it makes sense to look at them separately. So, whenever we will look at City-wise Analysis, we will look at these Cities as our **Top 4 Cities** - **Delhi, Muzaffarnagar, Kolkata, Mumbai.**

# VISUAL OVERVIEW

Here we will take a visual tour of the Data through Exploratory Data Analysis.

-   Let's see the AQI Levels in the Top 4 across all 3 measures - Max, Median and Min splitting the year into two halves.

```{r Yearly_Station_Bar_Month_Split, fig.asp=1, fig.width=12}
top_cities <- c("Delhi", "Muzaffarnagar", "Kolkata", "Mumbai")

p1 <- air_data_india_pollutants %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018))) %>%
  filter(City %in% top_cities, Month %in% c(1,2,3,4,5,6)) %>%
  gather(min, median, max, key = "Measure", value = "AQI") %>%
  group_by(Year, City, Measure) %>%
  summarise(Mean_AQI = mean(AQI)) %>%
  arrange(desc(Year, Mean_AQI)) %>%
  mutate(Year = as.character(Year)) %>%
  ggplot(aes(City, Mean_AQI)) +
  geom_bar(aes(fill = Measure), position = "dodge", stat = "identity") +
  labs(
    y = "Average AQI Levels",
    x = element_blank()
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  facet_wrap(~Year) + ggtitle("Average AQI Levels Across Our Top 4 Cities - First Half of Year") +
  theme(legend.position = "None") +
  scale_fill_viridis(discrete = TRUE)

p2 <- air_data_india_pollutants %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018))) %>%
  filter(City %in% top_cities, !(Month %in% c(1,2,3,4,5,6))) %>%
  gather(min, median, max, key = "Measure", value = "AQI") %>%
  group_by(Year, City, Measure) %>%
  summarise(Mean_AQI = mean(AQI)) %>%
  arrange(desc(Year, Mean_AQI)) %>%
  mutate(Year = as.character(Year)) %>%
  ggplot(aes(City, Mean_AQI)) +
  geom_bar(aes(fill = Measure), position = "dodge", stat = "identity") +
  labs(
    y = "Average AQI Levels"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  facet_wrap(~Year) + ggtitle("Average AQI Levels Across Our Top 4 Cities - Last Half of Year") +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 1,
      override.aes = list(size = 3)
    )
  )  +
  scale_fill_viridis(discrete = TRUE)

ggarrange(p1, p2, nrow = 2)
```

The first bit of observation is the **Median & Min AQI Levels of all 4 cities have dropped in 2020 and 2021 is similar to 2019**. But the **Max AQI Levels have increased in 2020 and even more in 2021** even though we had so many restrictions in 2020!

```{r City_AQI_Box, fig.asp=1, fig.width=12}
p1 <- air_data_india_pollutants %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018)), City %in% top_cities, Month %in% c(1,2,3,4,5,6)) %>%
  mutate(Year = as.character(Year)) %>%
  gather(min, median, max, key = "Measure", value = "AQI") %>%
  group_by(Year, Month, Day, City, Measure) %>%
  summarise(AQI = mean(AQI, na.rm = TRUE)) %>%
  ggplot(aes(City, AQI, fill =Year, color = Measure)) +
  geom_boxplot(outlier.shape = NA) + 
  #coord_cartesian(ylim = c(0, 200)) +
  labs(y = "Average AQI Levels", fill = "Year") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 1
    )
  )  + ggtitle("Average AQI Levels Across Our Top 4 Cities - First Half of Year") + 
  scale_fill_viridis(discrete = TRUE)

p2 <- air_data_india_pollutants %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018)), City %in% top_cities, !(Month %in% c(1,2,3,4,5,6))) %>%
  mutate(Year = as.character(Year)) %>%
  gather(min, median, max, key = "Measure", value = "AQI") %>%
  group_by(Year, Month, Day, City, Measure) %>%
  summarise(AQI = mean(AQI, na.rm = TRUE)) %>%
  ggplot(aes(City, AQI, fill =Year, color = Measure)) +
  geom_boxplot(outlier.shape = NA) + 
  #coord_cartesian(ylim = c(0, 250)) +
  labs(y = "Average AQI Levels", fill = "Year") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 1
    )
  )  + ggtitle("Average AQI Levels Across Our Top 4 Cities - Last Half of Year") +
  scale_fill_viridis(discrete = TRUE)

ggarrange(p1, p2, nrow = 2)
```

In the first half of the year 2020 Min and Median AQI Levels have dropped whereas in the second half of the year it either increased or remained same as that of 2019. 2021's observed values are pretty much the same as that of 2019 if not more. Max AQI Levels kept rising across the years irrespective of the part of the years. **The spread(Variance) of the resp. measures look the same across the years**.

-   Let's take a look at the pollutant-wise Levels in our Top 4 Cities.

```{r Specie_Yearly_Viz, fig.asp=1, fig.width=12}
Yearly_Specie <- air_data_india_pollutants %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018))) %>%
  group_by(Year, Specie) %>%
  summarise(Avg_Min = mean(min), Avg_Median = mean(median), Avg_Max = mean(max))

Yearly_Specie_1 <- Yearly_Specie %>%
  gather(Avg_Min, Avg_Median, Avg_Max, key = "Measure", value = "AQI") %>%
  spread(key = Specie, value = AQI)

p1 <- air_data_india_pollutants %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018)), Month %in% c(1,2,3,4,5,6), City %in% top_cities) %>%
  gather(min, median, max, key = "Measure", value = "AQI") %>%
  mutate(Year = as.character(Year)) %>%
  ggplot(aes(Specie, AQI, fill = Year)) +
  geom_boxplot(outlier.shape = NA) +
  coord_cartesian(ylim = c(0,550)) +
  labs(fill = "Year")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  facet_wrap(~City, scales = "free") +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 1
    )
  ) + ggtitle("Average Levels of Pollutants Across Our Top 4 Cities - First Half of Year") +
  scale_fill_viridis(discrete = TRUE)

p2 <- air_data_india_pollutants %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018)), !(Month %in% c(1,2,3,4,5,6)), City %in% top_cities) %>%
  gather(min, median, max, key = "Measure", value = "AQI") %>%
  mutate(Year = as.character(Year)) %>%
  ggplot(aes(Specie, AQI, fill = Year)) +
  geom_boxplot(outlier.shape = NA) +
  coord_cartesian(ylim = c(0,500)) +
  labs(fill = "Year")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  facet_wrap(~City, scales = "free") +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 1
    )
  ) + ggtitle("Average Levels of Pollutants Across Our Top 4 Cities - Last Half of Year") +
  scale_fill_viridis(discrete = TRUE)

ggarrange(p1, p2, nrow = 2)
```

Here we see an interesting effect of Lockdowns. **All the pollutants have decreased considerably in the First half of 2020 whereas in the Second half it has bumped up again to match the Levels of 2019 or even more! While the Levels of 2021 & 2019 are very similar**.

## RELATIONSHIPS - PATTERNS & TRENDS

-   Pollutant Gases and Particulate Matter, whose levels despite being affected by Human Intervention and Industrial Activities, are nothing but Natural Gases which follow nature's process. Here we will take a look at *how the AQI Levels change with seasons throughout the year*.

```{r Station_Monthly_Viz, fig.asp=0.8, fig.width=12}
Monthly_Pollutant_City <- air_data_india_pollutants %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017)) & City %in% avg_median_per_year_per_station$City[1:11]) %>%
  group_by(Year, Month, City) %>%
  summarise(Avg_Min = mean(min), Avg_Median = mean(median), Avg_Max = mean(max))

Monthly_Pollutant_City_1 <- Monthly_Pollutant_City %>%
  gather(Avg_Min, Avg_Median, Avg_Max, key = "Measure", value = "AQI")

air_data_india_All_Specie_Daily_AQI_formulated %>%
  filter(City %in% top_cities) %>%
  group_by(Year, Month, City) %>%
  summarise(AQI = mean(AQI)) %>%
  ggplot(aes(Month, AQI, color = Year)) +
  geom_point(size = 4, alpha = 0.7) +
  stat_smooth(se = FALSE, method = "lm", formula = y ~ x + I(x^2), size = 2) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), axis.line = element_line(colour = "black"),strip.background = element_blank()) +
  facet_wrap(~City) +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 1
    )
  ) + 
  facet_wrap(~City) + ggtitle("Monthly AQI Levels") +
  scale_color_viridis(discrete = TRUE)
```

Indeed it looks like the **AQI Levels have dropped in the first half of 2020 compared to 2019, with the exception of Mumbai. But it has increased to levels more than 2019 in the later half. The AQI Levels of 2021 is more that both the previous years**. I have fit here a Quadratic Model which seems to model the situation well though we shouldn't focus on the model fit to 2021 as we only have the data pertaining to first 6 months.

Now, we will see the above observed AQI Levels in terms of Levels of each Pollutants.

```{r Monthly_Pollutant_Viz_and_Daily_Data_wrangling_included, fig.asp=0.8, fig.width=13.5, warning=FALSE, message=FALSE}
Monthly_Specie <- air_data_india_pollutants %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018)), City %in% top_cities) %>%
  group_by(Year, Month, City, Specie) %>%
  summarise(Avg_Min = mean(min), Avg_Median = mean(median), Avg_Max = mean(max))
 

Monthly_Specie_1 <- Monthly_Specie %>%
  gather(Avg_Min, Avg_Median, Avg_Max, key = "Measure", value = "AQI") %>%
  spread(key = Specie, value = AQI)


Monthly_Specie_2 <- Monthly_Specie_1 %>%
  gather(co:so2, key = "Pollutants", value = "AQI") %>%
  mutate(Year = as.character(Year))

air_data_india_All_Specie_Daily <- air_data_india %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018)), City %in% top_cities) %>%
  group_by(Year, Month, Day, City, Specie) %>%
  summarise(Avg_Min = mean(min), Avg_Median = mean(median), Avg_Max = mean(max))

air_data_india_All_Specie_Daily_1 <- air_data_india_All_Specie_Daily %>%
  gather(Avg_Min, Avg_Median, Avg_Max, key = "Measure", value = "AQI")

air_data_india_All_Specie_Daily_2 <- air_data_india_All_Specie_Daily_1 %>%
  spread(key = Specie, value = AQI)

Monthly_Specie_2 %>%
  group_by(Year, Month, City, Pollutants) %>%
  summarise(AQI = mean(AQI)) %>%
  ggplot(aes(Month, AQI, color = Year)) +
  geom_point(alpha = 0.66, size = 3) +
  geom_smooth(se = FALSE, method = "lm", formula = y~x+I(x^2)) +
  labs(
    y = "Average AQI Levels"
  ) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),strip.background = element_blank()) +
  facet_wrap(~City + Pollutants, ncol = 6, scales = "free", labeller = label_wrap_gen(multi_line=FALSE)) +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 1,
      override.aes = list(size = 3) 
    )
  ) + ggtitle("Monthly Pollutant Levels") +
  scale_color_viridis(discrete = TRUE, option = "C")
```

**Except for Ground-Level Ozone and Sulphur Dioxide most of the Pollutant Levels have decreased during the first half of 2020 which saw an increase in the second half when compared to 2019.This increase can be attributed to increased Stubble Burning that took place in the later half of the Year**. The surprising thing is that even **particulate matter increased to much higher levels in Mumbai** even though it saw a massive lockdown and transportation as well as industrial work were suspended.

-   The Pollutant Levels are affected to a great deal by the weather conditions of a place. Here we try to look at *how the Pollutant Levels are related to other Pollutant Levels* and *how the weather parameters are related among themselves* followed by a dependency of *Pollutant Levels of weather parameters*.

```{r Monthly_Specie_Scatterplot_Matrix_pol_v_pol, fig.asp=0.7, fig.width=12, message=FALSE, warning=FALSE}
# Exploring the relationships between All Species with each other Monthly
air_data_india_All_Specie_Monthly <- air_data_india %>%
  filter(!(Year %in% c(2014, 2015, 2016, 2017, 2018))) %>%
  filter(City %in% top_cities) %>%
  group_by(Year, Month, City, Specie) %>%
  summarise(Avg_Min = mean(min, na.rm = TRUE), Avg_Median = mean(median, na.rm = TRUE), Avg_Max = mean(max, na.rm = TRUE)) %>%
  mutate(Year = as.character(Year))

air_data_india_All_Specie_Monthly_1 <- air_data_india_All_Specie_Monthly %>%
  gather(Avg_Min, Avg_Median, Avg_Max, key = "Measure", value = "AQI")

air_data_india_All_Specie_Monthly_2 <- air_data_india_All_Specie_Monthly_1 %>%
  spread(key = Specie, value = AQI)

my_fn <- function(data, mapping, ...){
  p <- ggplot(data = data, mapping = mapping) + 
    geom_point() + 
    geom_smooth(method=lm, formula = y~x, fill="red", color="blue", size = 0.5, se = FALSE, ...)
  p
}

# Actually here all the parameters with all the others except Year and Month are really highly correlated. So let's take a look at them 
air_data_india_All_Specie_Monthly_2 %>%
  ggpairs(columns = c("co", "no2", "o3", "so2", "pm10", "pm25"), aes(color = City, shape = Year), progress = FALSE, lower = list(continuous = my_fn)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) + ggtitle("Scatterplot Matrix for Pollutants") +
  scale_color_viridis(discrete = TRUE)

```

We see a **strong linear relationship between the pollutants** among themselves across the past 3 years at our Top Cities.

```{r Monthly_Specie_Scatterplot_Matrix_nonpol_v_nonpol, fig.asp=0.8, fig.width=12, message=FALSE, warning=FALSE}

air_data_india_All_Specie_Monthly_2 %>%
  ggpairs(columns = c("dew", "humidity", "pressure", "temperature", "wind-speed"), aes(color = City, shape = Year), progress = FALSE) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),strip.background = element_blank()) + ggtitle("Scatterplot Matrix for Weather Parameters") +
  scale_color_viridis(discrete = TRUE)
```

We see a **strong linear relationship between the weather parameters** across the past 3 years. One important thing that gives us a hint towards *why the pm10 and pm25 levels were higher in Mumbai*, as we see **Mumbai has experienced really high wind-speeds in 2020 and 2021. The pm content was thus increased due to movement of lots of dust by wind**.

```{r Monthly_Pol_non_Pol_Scatterplot_Matrix, fig.asp=0.8, fig.width=13, warning=FALSE}
air_data_india_Pollutants_nonpollutants_monthly <- air_data_india_All_Specie_Monthly_1 %>%
  filter(Year != 2018) %>% # There is a lot of Missing values in this year
  spread(key = Specie, value = AQI) %>%
  select(-precipitation, -`wind-gust`) %>%
  gather(dew, humidity, pressure, temperature, `wind-speed`, key = "non_pollutants", value = Levels) %>%
  gather(co, so2, no2, o3, pm10, pm25, key = "pollutants", value = "AQI")

air_data_india_Pollutants_nonpollutants_monthly %>%
  ggplot(aes(AQI, Levels, color = City)) +
  geom_point(alpha = 0.6, aes(shape = Year)) +
  geom_smooth(method = "lm", se = FALSE, formula = y~x, alpha = 0.1, size = 0.5, linetype = "dashed") +
  labs(y = "Weather Parameters Levels", x = "Pollutant Levels") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),strip.background = element_blank()) +
  facet_wrap(~non_pollutants + pollutants, ncol = 6, scales = "free", labeller = label_wrap_gen(multi_line=FALSE)) +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 1,
      override.aes = list(size = 5) 
    )
  ) + ggtitle("Pollutants and Weather Parameters Relationship") +
  coord_flip() +
  scale_color_viridis(discrete = TRUE)
```

This suggests that there is a **positive linear relationship between Temperature & Humidity and all the Pollutant Levels**. **Wind speed is indeed positively correlated with pm10 and pm25 which might be the cause for higher AQI in Mumbai**.

-   Another Important thing to keep in mind is *how the weather parameters change with seasons*.

```{r Monthly_nonpol_viz, fig.asp=0.7, fig.width=12}
air_data_india_Pollutants_nonpollutants_monthly %>%
  group_by(Year, Month, non_pollutants) %>%
  summarise(Levels = mean(Levels)) %>%
  ggplot(aes(Month, Levels, color = Year)) +
  geom_point(size = 3) +
  geom_smooth(se = FALSE, method = "lm", formula = y~x + I(x^2) + I(x^3)) +
  facet_wrap(~non_pollutants, scales = "free") +
  labs(y = "Levels")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),strip.background = element_blank()) +
  theme(legend.position = "bottom") +
  guides(
    fill = guide_legend(
      nrow = 1,
      override.aes = list(size = 3)
    )
  ) + ggtitle("Monthly Weather Parameter Levels") +
  scale_color_viridis(discrete = TRUE)
```

It suggests that the **wind-speeds and humidity were higher in 2020, whereas pressure and temperatures were lower in 2020**.

# STATISTICAL INFERENCE

## ESTIMATION

### DISTRIBUTIONS & PROBABILITY MODELS 

To perform any kind of analysis we need to model the data we have in order to get an idea about the expected value, variance and other properties related to the data. It also helps us get rid of the noise we get from the data we collect.

-   Here we will look at *how the different pollutants are distributed and how different are the models for different year & location and which probability model fits our data and what are the parameter estimates of the fitted model along with Mean and Variance.*

```{r model_fitting_functions}
fit_distribution <- function(data, title_name = "Model & Data", qqtitle = NULL){
  fit_g <<- invisible(fitdistrplus::fitdist(data, "gamma"))
  fit_l <<- invisible(fitdistrplus::fitdist(data, "lnorm"))
  fit_w <<- invisible(fitdistrplus::fitdist(data, "weibull"))
  fit_n <<- invisible(fitdistrplus::fitdist(data, "norm"))
  fit_e <<- invisible(fitdistrplus::fitdist(data, "exp"))
  
  plot.legend <- c("gamma", "lognormal", "weibull", "normal", "exponential")
  gof <<- fitdistrplus::gofstat(list(fit_g, fit_l, fit_w, fit_n, fit_e), fitnames = plot.legend)
  
  p1 <- fitdistrplus::denscomp(list(fit_g, fit_l, fit_w, fit_n, fit_e), legendtext = plot.legend, fitlwd = c(2,2,2,2,2), xlegend = 0.007, plotstyle = "ggplot") #, fit_e), legendtext = plot.legend, fitlwd = c(3,3.5,4,4.5,1), xlegend = 0.007)
  #fitdistrplus::cdfcomp (list(fit_g, fit_l, fit_w, fit_n, fit_e), legendtext = plot.legend)
  p2 <- fitdistrplus::qqcomp  (list(fit_g, fit_l, fit_w, fit_n, fit_e), legendtext = plot.legend, plotstyle = "ggplot") # , fit_e), legendtext = plot.legend, xlegend = 0.01, )
  #fitdistrplus::ppcomp  (list(fit_g, fit_l, fit_w, fit_n, fit_e), legendtext = plot.legend)
  
  p1 <- p1 +
    theme(legend.justification = c(1, 1), legend.position = c(1, 1)) + ggtitle(title_name) + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
  
  p2 <- p2  +
    theme(legend.position = "None") + ggtitle(qqtitle) + labs(subtitle = paste(rownames(as.data.frame(gof$ks[which.min(gof$ks)])), "seems to fit the data better.")) + theme(axis.title.x = element_blank(), axis.title.y = element_blank())
  
  
  #print(paste(rownames(as.data.frame(gof$ks[which.min(gof$ks)])), "seems to fit the data well"))
  #distfit.table <- tibble("Distribution" = c("Gamma", "Log-Norm", "Weibull", "Norm", "Expo"), "value" = gof$chisqpvalue) %>%
  #  spread(key = Distribution, value = value) %>%
  #  mutate(across(where(is.numeric), ~ round(., digits = 3)))
  #return(distfit.table)
  p <- ggarrange(p1, p2, ncol = 2)
  return(p)
}

proper_fit_distribution <- function(data, heading = "Model & Data"){
  
  invisible(capture.output(p <- fit_distribution(data, heading)))
  
  tf <<- (map_df(list(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$estimate), tidy)) %>%
    spread(key = names, value = x) %>% 
    mutate(across(where(is.numeric), ~ round(., digits = 2)))
  
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "exp")
    table <- ggtexttable(tibble(Fit = c(colnames(tf)[1], as.character(tf[1]))), theme = ttheme("mCyan"), rows = NULL)
  else
    table <- ggtexttable(tibble(Fit = c(colnames(tf)[1], as.character(tf[1]),colnames(tf)[2], as.character(tf[2])[1])), theme = ttheme("mCyan"), rows = NULL)
  
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "weibull")
    tablea <-  ggtexttable(tibble(Moments = c("Mean", round(find_mean(dweibull, scale = as.numeric(tf[1]), shape = as.numeric(tf[2]))$value, digits = 2), "Var", round(find_variance(dweibull, scale = as.numeric(tf[1]), shape = as.numeric(tf[2]))$value, digits = 2))), theme = ttheme("mGreen"), rows = NULL)
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "lnorm")
    tablea <-  ggtexttable(tibble(Moments = c("Mean", round(exp(as.numeric(tf[1]) + 0.5*as.numeric(tf[2])^2), digits = 2), "Var", round(exp(as.numeric(tf[1])*2 + 0.5*4*as.numeric(tf[2])^2) - (exp(as.numeric(tf[1])*1 + 0.5*as.numeric(tf[2])^2))^2, digits = 2))), theme = ttheme("mGreen"), rows = NULL)
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "gamma")
    tablea <-  ggtexttable(tibble(Moments = c("Mean", round(find_mean(dgamma, rate = as.numeric(tf[1]), shape = as.numeric(tf[2]))$value, digits = 2), "Var", round(find_variance(dgamma, rate = as.numeric(tf[1]), shape = as.numeric(tf[2]))$value, digits = 2))), theme = ttheme("mGreen"), rows = NULL)
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "norm")
    tablea <-  ggtexttable(tibble(Moments = c("Mean", round(find_mean(dnorm, mean = as.numeric(tf[1]), sd = as.numeric(tf[2]))$value, digits = 2), "Var", round(find_variance(dnorm, mean = as.numeric(tf[1]), sd = as.numeric(tf[2]))$value, digits = 2))), theme = ttheme("mGreen"), rows = NULL)
  if(list(fit_g, fit_l, fit_w, fit_n, fit_e)[as.numeric(which.min(gof$ks))][[1]]$distname == "exp")
    tablea <-  ggtexttable(tibble(Moments = c("Mean", round(1/as.numeric(tf[1]), digits = 2), "Var", round(1/(as.numeric(tf[1]))^2, digits = 2))), theme = ttheme("mGreen"), rows = NULL)
  
  table <- ggarrange(table, tablea, nrow = 2)
  
  p <- ggarrange(p, table, nrow = 1, ncol = 2, widths = c(10,1))
  return(p)
}

fit_distribution_all_cities <- function(data, flag = 1){
  # So2 Level prediction
  p1 <- proper_fit_distribution((data %>% filter(City == "Kolkata"))$so2, "Kolkata")
  p2 <- proper_fit_distribution((data %>% filter(City == "Delhi"))$so2, "Delhi")
  p3 <- proper_fit_distribution((data %>% filter(City == "Muzaffarnagar"))$so2, "Muzaffarnagar")
  p4 <- proper_fit_distribution((data %>% filter(City == "Mumbai"))$so2, "Mumbai")
  
  fit_so2 <- ggarrange(p1,p2,p3,p4, nrow = 2, ncol = 2)
  
  # No2 Level prediction
  p1 <- proper_fit_distribution((data %>% filter(City == "Kolkata"))$no2, "Kolkata")
  p2 <- proper_fit_distribution((data %>% filter(City == "Delhi"))$no2, "Delhi")
  p3 <- proper_fit_distribution((data %>% filter(City == "Muzaffarnagar"))$no2, "Muzaffarnagar")
  p4 <- proper_fit_distribution((data %>% filter(City == "Mumbai"))$no2, "Mumbai")
  
  fit_no2 <- ggarrange(p1,p2,p3,p4, nrow = 2, ncol = 2)
  
  # CO Level prediction
  p1 <- proper_fit_distribution((data %>% filter(City == "Kolkata"))$co, "Kolkata")
  p2 <- proper_fit_distribution((data %>% filter(City == "Delhi"))$co, "Delhi")
  p3 <- proper_fit_distribution((data %>% filter(City == "Muzaffarnagar"))$co, "Muzaffarnagar")
  p4 <- proper_fit_distribution((data %>% filter(City == "Mumbai"))$co, "Mumbai")
  
  fit_co <- ggarrange(p1,p2,p3,p4, nrow = 2, ncol = 2)
  
  # O3 Level prediction
  p1 <- proper_fit_distribution((data %>% filter(City == "Kolkata"))$o3, "Kolkata")
  p2 <- proper_fit_distribution((data %>% filter(City == "Delhi"))$o3, "Delhi")
  p3 <- proper_fit_distribution((data %>% filter(City == "Muzaffarnagar"))$o3, "Muzaffarnagar")
  p4 <- proper_fit_distribution((data %>% filter(City == "Mumbai"))$o3, "Mumbai")
  
  fit_o3 <- ggarrange(p1,p2,p3,p4, nrow = 2, ncol = 2)
  
  # pm10 Level prediction
  p1 <- proper_fit_distribution((data %>% filter(City == "Kolkata"))$pm10, "Kolkata")
  p2 <- proper_fit_distribution((data %>% filter(City == "Delhi"))$pm10, "Delhi")
  p3 <- proper_fit_distribution((data %>% filter(City == "Muzaffarnagar"))$pm10, "Muzaffarnagar")
  if(flag == 1)
    p4 <- proper_fit_distribution((data %>% filter(City == "Mumbai"))$pm10, "Mumbai")
  
  fit_pm10 <- ggarrange(p1,p2,p3,p4, nrow = 2, ncol = 2)
  
  # pm25 Level prediction
  p1 <- proper_fit_distribution((data %>% filter(City == "Kolkata"))$pm25, "Kolkata")
  p2 <- proper_fit_distribution((data %>% filter(City == "Delhi"))$pm25, "Delhi")
  p3 <- proper_fit_distribution((data %>% filter(City == "Muzaffarnagar"))$pm25, "Muzaffarnagar")
  p4 <- proper_fit_distribution((data %>% filter(City == "Mumbai"))$pm25, "Mumbai")
  
  fit_pm25 <- ggarrange(p1,p2,p3,p4, nrow = 2, ncol = 2)
  
  return(list("fit_so2"=fit_so2, "fit_no2"=fit_no2, "fit_co"=fit_co, "fit_o3"=fit_o3, "fit_pm10"=fit_pm10, "fit_pm25"=fit_pm25))
}
```

```{r expectation_variance_finders}
ev_finder <- function(transform = identity) {
  function(f, ..., from = -Inf, to = Inf) {
    integrate(function(x) transform(x) * f(x, ...), from, to)
  }
}

moment_finder <- function(n, c = 0) {
  ev_finder(function(x) (x - c) ^ n)
}

find_mean <- moment_finder(1)
find_variance <- function(f, ...) {
  mu <- find_mean(f, ...)$value
  moment_finder(2, mu)(f, ...)
}

```

```{r regress_estimation_data_prep, fig.asp=0.7, fig.width=12, cache=TRUE}
air_data_india_All_Specie_Daily_Regress <- air_data_india %>%
  group_by(Year, Month, Day,  Specie, City) %>%
  summarise(Min = mean(min, na.rm = TRUE), Median = mean(median, na.rm = TRUE), Max = mean(max, na.rm = TRUE), Var = mean(variance, na.rm = TRUE))

air_data_india_All_Specie_Daily_Regress <- air_data_india_All_Specie_Daily_Regress %>%
  gather(Min, Median, Max, Var, key = "Measure", value = "AQI")

air_data_india_All_Specie_Daily_Regress <- air_data_india_All_Specie_Daily_Regress %>%
  spread(key = Specie, value = AQI)

air_data_india_All_Specie_Daily_Regress <- air_data_india_All_Specie_Daily_Regress %>%
  filter(City %in% c("Kolkata", "Delhi", "Muzaffarnagar", "Mumbai")) %>%
  filter(Year %in% c(2019, 2020, 2021), Measure != "Var") %>%
  group_by(Year, Month, Day, City) %>%
  mutate(Year = as.character(Year)) %>%
  filter(!is.na(so2)) %>%
  filter(!is.na(no2)) %>%
  filter(!is.na(co)) %>%
  filter(!is.na(o3)) %>%
  filter(!is.na(pm25)) %>%
  filter(!(City == "Mumbai" & temperature < 15)) %>%
  filter(!((City == "Mumbai" & co > 50))) %>%
  filter((humidity >= 20 & humidity <= 100) & (dew >= 0 & dew <= 50) & (temperature >= 0 & temperature <= 55) & (pressure >= 600)) %>%
  filter(so2 > 0, no2 > 0, o3 > 0, co > 0, pm10 > 0, pm25 > 0)

```

```{r fit_distribution_all_cities, fig.asp=1.8, fig.width=14, warning=FALSE}
air_data_india_All_Specie_Daily_Regress_model <- air_data_india_All_Specie_Daily_Regress %>%
  filter(Year == 2019, Measure != "Var") %>% # ------------LOOOOOOOK
  filter(!(Month %in% c(1,2,3,4,5,6)))

city_distributions <- fit_distribution_all_cities(air_data_india_All_Specie_Daily_Regress_model)

fig1 <- annotate_figure(city_distributions$fit_pm25, top = text_grob("PM25 Distribution for first 6 Months of 2019", face = "bold", size = 14 ))

air_data_india_All_Specie_Daily_Regress_model <- air_data_india_All_Specie_Daily_Regress %>%
  filter(Year == 2020, Measure != "Var") %>% # ------------LOOOOOOOK
  filter(Month %in% c(1,2,3,4,5,6))

city_distributions <- fit_distribution_all_cities(air_data_india_All_Specie_Daily_Regress_model, flag = 0)

fig2 <- annotate_figure(city_distributions$fit_pm25, top = text_grob("PM25 Distribution for first 6 Months of 2020", face = "bold", size = 14 ))

air_data_india_All_Specie_Daily_Regress_model <- air_data_india_All_Specie_Daily_Regress %>%
  filter(Year == 2021, Measure != "Var") %>% # ------------LOOOOOOOK
  filter(Month %in% c(1,2,3,4,5,6))

city_distributions <- fit_distribution_all_cities(air_data_india_All_Specie_Daily_Regress_model)

fig3 <- annotate_figure(city_distributions$fit_pm25, top = text_grob("PM25 Distribution for first 6 Months of 2021", face = "bold", size = 14 ))

ggarrange(fig1, fig2, fig3, nrow = 3)
```

I have mostly tried **fitting one of Gamma, Lognormal, Normal, Weibull and Exponential Distribution by the Method of Maximum Likelihood Estimation** after looking at the histograms of the data for all the Pollutants. The **better model out of all these 5 models was chosen based on Chi-Squre test for goodness of fit**.

Looking at the moments of the fitted distribution we see one of the most important factor contributing to AQI Calculation i.e. **pm25 Levels during the first 6 months were much lower in all the cities except Mumbai in 2020 compared to 2019, whereas these levels increased back to a much higher value in 2021**.

Similar **Fitted Probability Models suggests almost all the Pollutant Levels were lower in 2020 compared to that of 2019, but the values of 2019 and 2021 are very similar, if not that of 2021 is higher**. I will attach all the relevant Plots and figures for other Pollutants at the end, if interested in looking at them.

There were also some cases were **outliers degraded the fit of the model, I tried minimizing the Hellinger Distance to fit the model in that case**. Below give is one such case -

```{r Hellinger_Fit, fig.asp=0.618, fig.width=12, warning=FALSE, message=FALSE}
# Calculates the sqrt(f).sqrt(g) things that needs to be maximized for minimum hellinger distance
hellinger_distance.minimizer <- function(...) {
  y <<- as.list(...) 
  x <<- as.list(c(NA, unlist(y)))
  x[[1]] <<- c(-Inf, gof$chisqbreaks, Inf)
  hellinger <<- sum(sqrt(diff(do.call(distribution, x)))*sqrt(as.data.frame(gof$chisqtable)[1:(length(gof$chisqbreaks)+1), 3] / sum(as.data.frame(gof$chisqtable)[1:(length(gof$chisqbreaks)+1), 3])))
  return(hellinger)
}

# Fits Model based on Minimizing Hellinger Distance
hellinger_fit <- function(data, distribution){
  data1 <<- data
  distribution <<- distribution
  fit <<- fitdistrplus::fitdist(data, sub('.', '', distribution))
  gof <<- fitdistrplus::gofstat(fit, fitnames = c(sub('.', '', distribution))) 
  estimates <<- optim(par = as.vector(fit$estimate), fn = hellinger_distance.minimizer, control = list(fnscale=-1))
  sq_hellinger_dist <<- sum(diff(do.call(distribution, x))) + sum(as.data.frame(gof$chisqtable)[1:(length(gof$chisqbreaks)+1), 3] / sum(as.data.frame(gof$chisqtable)[1:(length(gof$chisqbreaks)+1), 3])) - 2*hellinger_distance.minimizer(estimates$par)
  return(list("Hellinger_Estimates" = estimates$par, "Square_Hellinger_Distance" = sq_hellinger_dist))
}

# Comparing Hellinger Fit with MLE Fit
compare_hellinger_fit_v_MLE <- function(data, distribution){
  invisible(capture.output(fit_MLE <<- fitdistrplus::fitdist(data, sub('.', '', distribution))))
  invisible(capture.output(fit_hellinger <<- fitdistrplus::fitdist(data, sub('.', '', distribution))))
  invisible(capture.output(fit_hellinger$estimate <<- hellinger_fit(data, distribution)$Hellinger_Estimates))
  
  plot.legend <- c("MLE_Fit", "Hellinger_Fit")
  p1 <- fitdistrplus::denscomp(list(fit_MLE, fit_hellinger), legendtext = plot.legend, fitlwd = c(2, 2), xlegend = 0.007, plotstyle = "ggplot")
  p2 <- fitdistrplus::qqcomp  (list(fit_MLE, fit_hellinger), legendtext = plot.legend, plotstyle = "ggplot")
  p1 <- p1 + theme(legend.justification = c(1, 1), legend.position = c(1, 1)) + ggtitle("Hellinger Fit vs MLE Fit Model")
  p2 <- p2 + theme(legend.position = "None")
  ggarrange(p1, p2, ncol = 2)
}

air_data_pollutants_2021_avg_median <- air_data_india_Pollutants_nonpollutants_daily %>%
  filter(Year == 2021 & Measure == "Avg_Max") %>% # ------------------------------LOOOOOOOOOOOOOOOOOOK!!!!!!!!
  select(-c("non_pollutants", "Levels"))

air_data_pollutants_2021_avg_median_all_pol_summarized_wo_pm <- air_data_pollutants_2021_avg_median %>%
  filter(!(pollutants %in% c("pm10", "pm25"))) %>%
  ungroup() %>%
  group_by(Year, Month, Day) %>%
  summarise(Mean_AQI = mean(AQI, na.rm = TRUE))

annotate_figure(compare_hellinger_fit_v_MLE(air_data_pollutants_2021_avg_median_all_pol_summarized_wo_pm$Mean_AQI, "pweibull"), top = text_grob("Average Median Pollutant Levels(Except pm10 & pm25), 2021", face = "bold", size = 14))
```

It is clear that the **Hellinger fit is much better in fitting the part of the distribution where there are maximum observations**.
